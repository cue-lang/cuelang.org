# Test CDD mode functionality
# Ensure that --cdd mode processes content without requiring hugo directory structure
# and uses the specified output directory

# Create output directory
mkdir output

# Run the preprocessor in CDD mode
exec preprocessor execute --cdd --cddoutputdir=output

# Verify that output files were created in the specified directory
cmp output/en/example/index.md golden/output/en/example/index.md

# Verify filesystem contents
exec cmd-find
cmp stdout stdout.golden

-- example/en.md --
---
title: CDD test example
---

This is a test file for CDD mode.

{{{with script "en" "test"}}}
#location top
echo "test script output"
{{{end}}}

-- example/gen_cache.cue --
package cache

command: test: {
	task: print: {
		kind: "print"
		text: "test script output"
	}
}

-- example/site.cue --
package site

example: page: {
	leftDelim:  "{{{"
	rightDelim: "}}}"
}

-- golden/output/en/example/index.md --
---
title: CDD test example
---

This is a test file for CDD mode.

``` { .text title="TERMINAL" data-copy="echo &#34;test script output&#34;" }
$ echo "test script output"
test script output
```

-- stdout.golden --
output/en/example/index.md