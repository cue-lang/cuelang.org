---
title: Generating CUE from local Go code
toc_hide: true
tags:
- cue command
authors:
- myitcv
- jpluscplusm
---

This guide demonstrates how to generate CUE from types defined in a local Go
main package, placing the CUE in the same directory as the Go code.

<!--more-->

## Initialize Go and CUE modules

[**:material-chevron-right-circle-outline: Step 1**](#step-1){id="step-1"}: Create a Go module, or use an existing one if that's more suitable for your situation:

```` { .text title="TERMINAL" data-copy="go mod init an.example" }
$ go mod init an.example
...
````

---


[**:material-chevron-right-circle-outline: Step 2**](#step-2){id="step-2"}: Create a CUE module if you don't already have one:

```` { .text title="TERMINAL" data-copy="cue mod init an.example" }
$ cue mod init an.example
````

This module will hold the CUE generated from your local Go types.

---


## Fetch or create your Go types

[**:material-chevron-right-circle-outline: Step 3**](#step-3){id="step-3"}: Place Go code in the current working directory that contains the types you're
interested in.
If you are following this guide by working inside an existing Go package then
the code and types will already be in place.

This guide uses the following example:
a simple program that loads a JSON-encoded config from its `stdin`.

You don't need to use this example in any way.
**You should use your own Go code and types.**

```` { .go title="main.go" }
package main

import (
	"encoding/json"
	"fmt"
	"log"
	"os"
)

type Config struct {
	Vals  []Val `json:"vals"`
	Level int   `json:"level"`
}

type Val struct {
	Name  string `json:"name"`
	Value string `json:"value"`
}

func main() {
	var cfg Config
	dec := json.NewDecoder(os.Stdin)
	if err := dec.Decode(&cfg); err != nil {
		log.Fatal(err)
	}

	fmt.Printf("Config level: %d.\n", cfg.Level)
	fmt.Printf("Val count: %d.\n", len(cfg.Vals))
	if len(cfg.Vals) > 0 {
		fmt.Printf("First val name: %q.\n", cfg.Vals[0].Name)
	}
}
````

`config.json` contains a sample configuration to test our example program:

```` { .json title="config.json" }
{
    "level": 42,
    "vals": [
        {
            "name": "cueckoo",
            "value": "bird"
        },
        {
            "name": "porcuepine",
            "value": "mammal"
        }
    ]
}
````

We check that our example code accepts the sample configuration:

```` { .text title="TERMINAL" data-copy="cat config.json | go run ." }
$ cat config.json | go run .
Config level: 42.
Val count: 2.
First val name: "cueckoo".
````

---


## Generate CUE from Go types

[**:material-chevron-right-circle-outline: Step 4**](#step-4){id="step-4"}: Use the `cue` command to generate CUE from the Go types in the `main` package:

```` { .text title="TERMINAL" data-copy="cue get go --local ." }
$ cue get go --local .
````

The `main` package is inferred from the Go files present in our
example and the symbol `.`, which refers to the Go package in the current
working directory.
The `--local` flag is required because of [issue #452](/issue/452), and when that
issue is resolved the flag won't be needed (so long as the CUE and Go package
import paths are identical).

---


[**:material-chevron-right-circle-outline: Step 5**](#step-5){id="step-5"}: Inspect the generated CUE code:

```` { .cue title="main_go_gen.cue" }
// Code generated by cue get go. DO NOT EDIT.

//cue:generate cue get go an.example

package main

#Config: {
	vals: [...#Val] @go(Vals,[]Val)
	level: int @go(Level)
}

#Val: {
	name:  string @go(Name)
	value: string @go(Value)
}
````


---


## Test the generated CUE

[**:material-chevron-right-circle-outline: Step 6**](#step-6){id="step-6"}: We can use `cue vet` to validate our sample config file against the generated CUE:

```` { .text title="TERMINAL" data-copy="cue vet -c -d &#39;#Config&#39; . config.json" }
$ cue vet -c -d '#Config' . config.json
````

Your Go code will probably have known-good and known-bad data for testing your generated CUE.

---

## Related content

- {{< linkto/related/reference "command/cue-help-get-go" >}}
- Issue [#452](/issue/452): path resolution issue for files generated by `cue get go`
- {{< linkto/related/howto "generate-cue-from-go-dependency" >}}
