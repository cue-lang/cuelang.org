---
title: Generating CUE from local Go code
toc_hide: true
tags:
- cue command
authors:
- myitcv
- jpluscplusm
---

This guide demonstrates how to generate CUE from types defined in a local Go
main package, placing the CUE in the same directory as the Go code.

{{{with _script_ "en" "set caches to speed up re-running"}}}
export GOMODCACHE=/caches/gomodcache
export GOCACHE=/caches/gobuild
{{{end}}}

## Initialize Go and CUE modules

{{{with step}}}
Create a Go module, or use an existing one if that's more suitable for your situation:

{{{with script "en" "go mod init"}}}
#ellipsis 0
go mod init an.example
{{{end}}}
{{{end}}}

{{{with step}}}
Create a CUE module if you don't already have one:

{{{with script "en" "cue mod init"}}}
cue mod init an.example
{{{end}}}

This module will hold the CUE generated from your local Go types.
{{{end}}}

## Fetch or create your Go types

{{{with step}}}
Place Go code in the current working directory that contains the types you're
interested in.
If you are following this guide by working inside an existing Go package then
the code and types will already be in place.

This guide uses the following example:
a simple program that loads a JSON-encoded config from its `stdin`.

You don't need to use this example in any way.
**You should use your own Go code and types.**

{{{with upload "en" "main.go"}}}
-- main.go --
package main

import (
	"encoding/json"
	"fmt"
	"log"
	"os"
)

type Config struct {
	Vals  []Val `json:"vals"`
	Level int   `json:"level"`
}

type Val struct {
	Name  string `json:"name"`
	Value string `json:"value"`
}

func main() {
	var cfg Config
	dec := json.NewDecoder(os.Stdin)
	if err := dec.Decode(&cfg); err != nil {
		log.Fatal(err)
	}

	fmt.Printf("Config level: %d.\n", cfg.Level)
	fmt.Printf("Val count: %d.\n", len(cfg.Vals))
	if len(cfg.Vals) > 0 {
		fmt.Printf("First val name: %q.\n", cfg.Vals[0].Name)
	}
}
{{{end}}}

`config.json` contains a sample configuration to test our example program:

{{{with upload "en" "config.json"}}}
-- config.json --
{
    "level": 42,
    "vals": [
        {
            "name": "cueckoo",
            "value": "bird"
        },
        {
            "name": "porcuepine",
            "value": "mammal"
        }
    ]
}
{{{end}}}

We check that our example code accepts the sample configuration:

{{{with script "en" "initial test"}}}
cat config.json | go run .
{{{end}}}
{{{end}}}

## Generate CUE from Go types

{{{with step}}}
Use the `cue` command to generate CUE from the Go types in the `main` package:

{{{with script "en" "cue get go"}}}
cue get go --local .
{{{end}}}

The `main` package is inferred from the Go files present in our
example and the symbol `.`, which refers to the Go package in the current
working directory.
The `--local` flag is required because of {{< issue 452 />}}, and when that
issue is resolved the flag won't be needed (so long as the CUE and Go package
import paths are identical).
{{{end}}}

{{{with _script_ "en" "backup generated cue"}}}
mv main_go_gen.cue .main_go_gen.cue
{{{end}}}

{{{with step}}}
Inspect the generated CUE code:

{{{with upload "en" "generated cue"}}}
-- main_go_gen.cue --
// Code generated by cue get go. DO NOT EDIT.

//cue:generate cue get go an.example

package main

#Config: {
	vals: [...#Val] @go(Vals,[]Val)
	level: int @go(Level)
}

#Val: {
	name:  string @go(Name)
	value: string @go(Value)
}
{{{end}}}

{{{end}}}

{{{with _script_ "en" "ensure generated cue matches upload"}}}
diff main_go_gen.cue .main_go_gen.cue
{{{end}}}

## Test the generated CUE

{{{with step}}}
We can use `cue vet` to validate our sample config file against the generated CUE:

{{{with script "en" "vet config using CUE"}}}
cue vet -d '#Config' . config.json
{{{end}}}

Your Go code will probably have known-good and known-bad data for testing your generated CUE.
{{{end}}}

{{{with _script_ "en" "https://github.com/cue-lang/docs-and-content/issues/186 #1"}}}
go vet ./...
#ellipsis 0
go run honnef.co/go/tools/cmd/staticcheck@v0.5.1 ./...
{{{end}}}

## Related content

- {{< linkto/related/reference "command/cue-help-get-go" >}}
- Issue {{< issue 452 >}}#452{{</issue>}}: path resolution issue for files generated by `cue get go`
- {{< linkto/related/howto "generate-cue-from-go-dependency" >}}
