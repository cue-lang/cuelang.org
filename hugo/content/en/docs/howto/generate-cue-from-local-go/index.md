---
title: Generating CUE from local Go code
toc_hide: true
tags:
- cue command
authors:
- myitcv
- jpluscplusm
---

This guide demonstrates how to generate CUE from types defined in a local Go
main package, placing the CUE in the same directory as the Go code.

## Initialize Go and CUE modules

{{< step stepNumber="1" >}}
Create a Go module, or use an existing one if that's more suitable for your situation:

```text { title="TERMINAL" codeToCopy="Z28gbW9kIGluaXQgYW4uZXhhbXBsZQ==" }
$ go mod init an.example
...
```
{{< /step >}}

{{< step stepNumber="2" >}}
Create a CUE module if you don't already have one:

```text { title="TERMINAL" codeToCopy="Y3VlIG1vZCBpbml0IGFuLmV4YW1wbGU=" }
$ cue mod init an.example
```

This module will hold the CUE generated from your local Go types.
{{< /step >}}

## Fetch or create your Go types

{{< step stepNumber="3" >}}
Place Go code in the current working directory that contains the types you're
interested in.
If you are following this guide by working inside an existing Go package then
the code and types will already be in place.

This guide uses the following example:
a simple program that loads a JSON-encoded config from its `stdin`.

You don't need to use this example in any way.
**You should use your own Go code and types.**

{{< code-tabs >}}
{{< code-tab name="main.go" language="go" area="top-left" >}}
package main

import (
	"encoding/json"
	"fmt"
	"log"
	"os"
)

type Config struct {
	Vals  []Val `json:"vals"`
	Level int   `json:"level"`
}

type Val struct {
	Name  string `json:"name"`
	Value string `json:"value"`
}

func main() {
	var cfg Config
	dec := json.NewDecoder(os.Stdin)
	if err := dec.Decode(&cfg); err != nil {
		log.Fatal(err)
	}

	fmt.Printf("Config level: %d.\n", cfg.Level)
	fmt.Printf("Val count: %d.\n", len(cfg.Vals))
	if len(cfg.Vals) > 0 {
		fmt.Printf("First val name: %q.\n", cfg.Vals[0].Name)
	}
}
{{< /code-tab >}}
{{< /code-tabs >}}

`config.json` contains a sample configuration to test our example program:

{{< code-tabs >}}
{{< code-tab name="config.json" language="json" area="top-left" >}}
{
    "level": 42,
    "vals": [
        {
            "name": "cueckoo",
            "value": "bird"
        },
        {
            "name": "porcuepine",
            "value": "mammal"
        }
    ]
}
{{< /code-tab >}}
{{< /code-tabs >}}

We check that our example code accepts the sample configuration:

```text { title="TERMINAL" codeToCopy="Y2F0IGNvbmZpZy5qc29uIHwgZ28gcnVuIC4=" }
$ cat config.json | go run .
Config level: 42.
Val count: 2.
First val name: "cueckoo".
```
{{< /step >}}

## Generate CUE from Go types

{{< step stepNumber="4" >}}
Use the `cue` command to generate CUE from the Go types in the `main` package:

```text { title="TERMINAL" codeToCopy="Y3VlIGdldCBnbyAtLWxvY2FsIC4=" }
$ cue get go --local .
```

The `main` package is inferred from the Go files present in our
example and the symbol `.`, which refers to the Go package in the current
working directory.
The `--local` flag is required because of {{< issue 452 />}}, and when that
issue is resolved the flag won't be needed (so long as the CUE and Go package
import paths are identical).
{{< /step >}}
{{< step stepNumber="5" >}}
Inspect the generated CUE code:

{{< code-tabs >}}
{{< code-tab name="main_go_gen.cue" language="cue" area="top-left" >}}
// Code generated by cue get go. DO NOT EDIT.

//cue:generate cue get go an.example

package main

#Config: {
	vals: [...#Val] @go(Vals,[]Val)
	level: int @go(Level)
}

#Val: {
	name:  string @go(Name)
	value: string @go(Value)
}
{{< /code-tab >}}
{{< /code-tabs >}}

{{< /step >}}
## Test the generated CUE

{{< step stepNumber="6" >}}
We can use `cue vet` to validate our sample config file against the generated CUE:

```text { title="TERMINAL" codeToCopy="Y3VlIHZldCAtZCAnI0NvbmZpZycgLiBjb25maWcuanNvbg==" }
$ cue vet -d '#Config' . config.json
```

Your Go code will probably have known-good and known-bad data for testing your generated CUE.
{{< /step >}}

## Related content

- {{< linkto/related/reference "cli/cue-get-go" >}}
- Issue {{< issue 452 >}}#452{{</issue>}}: path resolution issue for files generated by `cue get go`
- {{< linkto/related/howto "generate-cue-from-go-dependency" >}}
