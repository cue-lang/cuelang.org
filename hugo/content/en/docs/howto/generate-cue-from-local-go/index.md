---
title: Generate CUE from a local Go code
toc_hide: true
tags:
    - cue command
---

{{< step stepNumber="1" >}}
Create a Go module to hold our example:

```text { title="TERMINAL" codeToCopy="Z28gbW9kIGluaXQgbW9kLmV4YW1wbGU=" }
$ go mod init mod.example
go: creating new go.mod: module mod.example
```

{{< /step >}}

{{< step stepNumber="2" >}}
Write a simple main program that loads JSON encoded config from `stdin`:

```go { title="main.go" }
package main

import (
	"encoding/json"
	"fmt"
	"log"
	"os"
)

type Config struct {
	Vals  []Val `json:"vals"`
	Level int   `json:"level"`
}

type Val struct {
	Name  string `json:"name"`
	Value string `json:"value"`
}

func main() {
	var cfg Config
	dec := json.NewDecoder(os.Stdin)
	if err := dec.Decode(&cfg); err != nil {
		log.Fatal(err)
	}

	fmt.Printf("Your config is level: %d\n", cfg.Level)
	fmt.Printf("It specifies %d vals\n", len(cfg.Vals))
	if len(cfg.Vals) > 0 {
		fmt.Printf("The first val is named %q\n", cfg.Vals[0].Name)
	}
}
```

{{< /step >}}

{{< step stepNumber="3" >}}
Write some sample configuration:

```json { title="config.json" }
{
    "level": 42,
    "vals": [
        {
            "name": "cueckoo",
            "value": "bird"
        },
        {
            "name": "porcuepine",
            "value": "animal"
        }
    ]
}
```

{{< /step >}}

{{< step stepNumber="4" >}}
Check that we can run our program passing in the sample configuration:

```text { title="TERMINAL" codeToCopy="Z28gcnVuIC4gPGNvbmZpZy5qc29u" }
$ go run . <config.json
Your config is level: 42
It specifies 2 vals
The first val is named "cueckoo"
```

{{< /step >}}

{{< step stepNumber="5" >}}
Create a CUE module to hold the CUE generated from the local Go types:

```text { title="TERMINAL" codeToCopy="Y3VlIG1vZCBpbml0IG1vZC5leGFtcGxl" }
$ cue mod init mod.example
```

{{< /step >}}

{{< step stepNumber="6" >}}
Generate CUE from the Go types in the `main` package:

```text { title="TERMINAL" codeToCopy="Y3VlIGdldCBnbyAtLWxvY2FsIC4=" }
$ cue get go --local .
```

{{< /step >}}
{{< step stepNumber="7" >}}
Inspect the generated CUE code:

```cue { title="main_go_gen.cue" }
// Code generated by cue get go. DO NOT EDIT.

//cue:generate cue get go mod.example

package main

#Config: {
	vals: [...#Val] @go(Vals,[]Val)
	level: int @go(Level)
}

#Val: {
	name:  string @go(Name)
	value: string @go(Value)
}
```

{{< /step >}}
{{< step stepNumber="8" >}}
Use `cue vet` to validate our sample config file:

```text { title="TERMINAL" codeToCopy="Y3VlIHZldCAtZCAnI0NvbmZpZycgLiBjb25maWcuanNvbg==" }
$ cue vet -d '#Config' . config.json
```

{{< /step >}}
